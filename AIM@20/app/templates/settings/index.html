{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h2 mb-0">Settings</h1>
                    <p class="text-muted mb-0">Customize your productivity experience</p>
                </div>
                <div class="d-flex gap-2">
                    <form method="POST" action="{{ url_for('settings.reset') }}" class="d-inline"
                          onsubmit="return confirm('Are you sure you want to reset all settings to defaults?')">
                        <button type="submit" class="btn btn-outline-warning">
                            <i class="fas fa-undo me-1"></i>Reset to Defaults
                        </button>
                    </form>
                    <button type="submit" form="settings-form" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <form id="settings-form" method="POST" action="{{ url_for('settings.index') }}">
        <!-- Pomodoro Timer Settings -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Pomodoro Timer Settings</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="pomodoro_work_duration" class="form-label">Work Session Duration (minutes)</label>
                        <input type="number" class="form-control" id="pomodoro_work_duration" name="pomodoro_work_duration"
                               min="1" max="120" value="{{ user_settings.pomodoro_work_duration }}" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="pomodoro_break_duration" class="form-label">Short Break Duration (minutes)</label>
                        <input type="number" class="form-control" id="pomodoro_break_duration" name="pomodoro_break_duration"
                               min="1" max="60" value="{{ user_settings.pomodoro_break_duration }}" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="long_break_duration" class="form-label">Long Break Duration (minutes)</label>
                        <input type="number" class="form-control" id="long_break_duration" name="long_break_duration"
                               min="1" max="120" value="{{ user_settings.long_break_duration }}" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="sessions_until_long_break" class="form-label">Sessions Until Long Break</label>
                        <input type="number" class="form-control" id="sessions_until_long_break" name="sessions_until_long_break"
                               min="1" max="10" value="{{ user_settings.sessions_until_long_break }}" required>
                    </div>
                </div>
            </div>
        </div>

        <!-- Preferred Study Times -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Preferred Study Times</h5>
            </div>
            <div class="card-body">
                <div id="preferred-times">
                    {% set preferred_times = user_settings.get_preferred_times() %}
                    {% for time in preferred_times %}
                    <div class="input-group mb-2 preferred-time-group">
                        <input type="time" class="form-control" name="preferred_times[]" value="{{ time }}">
                        <button type="button" class="btn btn-outline-danger remove-time">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    {% endfor %}
                </div>
                <button type="button" class="btn btn-outline-primary btn-sm" id="add-time">
                    <i class="fas fa-plus me-1"></i>Add Time Slot
                </button>
                <div class="form-text">Set your preferred times for study sessions (used by AI scheduler)</div>
            </div>
        </div>

        <!-- Notification Settings -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-bell me-2"></i>Notifications</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="notifications_enabled" name="notifications_enabled"
                               {{ 'checked' if user_settings.notifications_enabled else '' }}>
                        <label class="form-check-label" for="notifications_enabled">
                            Enable notifications
                        </label>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="goal_deadline_reminders" name="goal_deadline_reminders"
                               {{ 'checked' if user_settings.goal_deadline_reminders else '' }}>
                        <label class="form-check-label" for="goal_deadline_reminders">
                            Goal deadline reminders
                        </label>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="goal_achievement_notifications" name="goal_achievement_notifications"
                               {{ 'checked' if user_settings.goal_achievement_notifications else '' }}>
                        <label class="form-check-label" for="goal_achievement_notifications">
                            Goal achievement notifications
                        </label>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="reminder_days_before" class="form-label">Days before deadline to send reminder</label>
                    <input type="number" class="form-control" id="reminder_days_before" name="reminder_days_before"
                           min="0" max="30" value="{{ user_settings.reminder_days_before }}">
                </div>
            </div>
        </div>

        <!-- Accessibility Settings -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-universal-access me-2"></i>Accessibility & Language</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="tts_enabled" name="tts_enabled"
                               {{ 'checked' if user_settings.tts_enabled else '' }}>
                        <label class="form-check-label" for="tts_enabled">
                            Enable text-to-speech (TTS)
                        </label>
                    </div>
                    <div class="form-text">Read content aloud for better accessibility</div>
                </div>
                <div class="mb-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="stt_enabled" name="stt_enabled"
                               {{ 'checked' if user_settings.stt_enabled else '' }}>
                        <label class="form-check-label" for="stt_enabled">
                            Enable speech-to-text (STT)
                        </label>
                    </div>
                    <div class="form-text">Convert speech to text for easier input</div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="language" class="form-label">Language</label>
                        <select class="form-select" id="language" name="language">
                            <option value="en" {{ 'selected' if user_settings.language == 'en' else '' }}>English</option>
                            <option value="es" {{ 'selected' if user_settings.language == 'es' else '' }}>Spanish</option>
                            <option value="fr" {{ 'selected' if user_settings.language == 'fr' else '' }}>French</option>
                            <option value="de" {{ 'selected' if user_settings.language == 'de' else '' }}>German</option>
                            <option value="zh" {{ 'selected' if user_settings.language == 'zh' else '' }}>Chinese</option>
                            <option value="ar" {{ 'selected' if user_settings.language == 'ar' else '' }}>Arabic</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="timezone" class="form-label">Timezone</label>
                        <select class="form-select" id="timezone" name="timezone">
                            <option value="Africa/Lagos" {{ 'selected' if user_settings.timezone == 'Africa/Lagos' else '' }}>West Africa (Lagos)</option>
                            <option value="Europe/London" {{ 'selected' if user_settings.timezone == 'Europe/London' else '' }}>London</option>
                            <option value="America/New_York" {{ 'selected' if user_settings.timezone == 'America/New_York' else '' }}>New York</option>
                            <option value="America/Los_Angeles" {{ 'selected' if user_settings.timezone == 'America/Los_Angeles' else '' }}>Los Angeles</option>
                            <option value="Asia/Tokyo" {{ 'selected' if user_settings.timezone == 'Asia/Tokyo' else '' }}>Tokyo</option>
                            <option value="Australia/Sydney" {{ 'selected' if user_settings.timezone == 'Australia/Sydney' else '' }}>Sydney</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-user me-2"></i>Account Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" value="{{ current_user.username }}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" value="{{ current_user.email }}" readonly>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Member Since</label>
                    <input type="text" class="form-control" value="{{ current_user.created_at.strftime('%B %d, %Y') }}" readonly>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add time slot functionality
    const addTimeButton = document.getElementById('add-time');
    const preferredTimesContainer = document.getElementById('preferred-times');

    addTimeButton.addEventListener('click', function() {
        const timeGroup = document.createElement('div');
        timeGroup.className = 'input-group mb-2 preferred-time-group';
        timeGroup.innerHTML = `
            <input type="time" class="form-control" name="preferred_times[]">
            <button type="button" class="btn btn-outline-danger remove-time">
                <i class="fas fa-trash"></i>
            </button>
        `;
        preferredTimesContainer.appendChild(timeGroup);
    });

    // Remove time slot functionality
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-time') || e.target.closest('.remove-time')) {
            e.target.closest('.preferred-time-group').remove();
        }
    });
});
</script>
{% endblock %}